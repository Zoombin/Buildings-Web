<!DOCTYPE html><html><head><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1"><meta name="keywords" content=""><meta name="description" content=""><meta charset="utf-8"><link href="../css/bootstrap.css" rel="stylesheet"><link href="../css/onepage-scroll.css" rel="stylesheet"><link href="../css/theme.css" rel="stylesheet"></head><body><div class="container-fluid" id="container"></div></body></html><script src="../js/jquery.js"></script><script src="../js/jquery.onepage-scroll.js"></script><script src="../js/script.js"></script><script>$(document).ready(function(){function e(e){var n=BrokerWeb,t={clientName:n.customer.client.name,clientPhone:n.customer.client.phone,recommendedBuilding:e.buildingId,brokerId:e.brokerId},a="/broker/rest/broker/brokerRecommendClient";n.screen.lock(),$.ajax({url:n.apiBaseUrl+a,type:"POST",data:t,dataType:"json",success:function(e){n.screen.unlock(),e.result?window.location.href="ShowDialog:900950.com?msg="+e.value:window.location.href="ShowDialog:900950.com?msg="+e.value},error:function(){n.screen.unlock()}})}function n(){$("#container").onepage_scroll({direction:"horizontal",loop:"false"});var e=[],n=[];$("#container .section").each(function(){e.push($(this).height()),n.push($(this).attr("style"))});var t=Math.max.apply(Math,e),a=$(window).height();$("#container").height(t>a?t:a),$(".onepage-pagination").css("top",.93*a+"px")}function t(){var e=BrokerWeb,n={brokerId:e.brokerid,relationId:e.params.clientId};e.screen.lock("处理中..."),$(this).hasClass("on")?$.ajax({url:e.apiBaseUrl+"/broker/rest/collect/delCollect",type:"POST",data:n,dataType:"json",success:function(n){e.screen.unlock(),n.result&&$(".important").removeClass("on"),window.location.href="ShowDialog:900950.com?msg=取消重要客户"},error:function(){e.screen.unlock()}}):$.ajax({url:e.apiBaseUrl+"/broker/rest/collect/collect/1",type:"POST",data:n,dataType:"json",success:function(n){e.screen.unlock(),n.result&&$(".important").addClass("on"),window.location.href="ShowDialog:900950.com?msg=已标为重要客户"},error:function(){e.screen.unlock()}})}function a(e){var n=BrokerWeb,t=n.customer.client,a=$('<div class="row text-center bg-user m0"></div>').append($('<div class="col-xs-8 text-left pr0"></div>').append($('<div class="pt20 pb20"></div>').append($("<div></div>").append($('<span class="text-mid text-333" id="name"></span>').html(t.name)).append($('<img src="" class="img-line-mid" id="photosrc" />').attr("src","../img/account_ico_"+("null"!=t.gender&&t.gender?"male":"female")+".png")).append($('<span class="text-green" id="phone"></span>').html(n.phoneAddSpace(t.phone)))).append($('<div class="text-666 lh-mid mt5" ></div>').append($("<div>推荐购买：</div>").append($("<span></span>").html(e.buildingName))).append($("<div>平均佣金：</div>").append($("<span></span>").html(e.buildingRatio))).append($('<div style="white-space:nowrap;">有效日期：</div>').append($("<span></span>").html(e.protectTime)).append(parseInt(e.clientStatus)>0?"":$('<span class="label label-green ml5 re-push">重新推荐</span>').click(function(){BrokerWeb.rePush(e)})))))).append($('<div class="col-xs-4 pr0 pl0 pt20 pb20"></div>').append(e.isSigned?$('<div class="customer-right mb10"></div>').append($('<div class="right-ok fs11"></div>').append($("<div>").html(n.clientStatus[e.clientStatus]))):"").append($('<div class="customer-right"></div>').append($('<div class="important"><div>重要客户</div></div>').addClass(BrokerWeb.isCollect?"on":"")))),o=e.historys,s=$('<ul class="cust-stat list-unstyled"></ul>');return $.each(o,function(e,t){s.append($('<li class="bg-white mt15"></li>').append($('<div class="point"></div>').addClass(0==e?"active":"")).append(o.length>1?$('<div class="line"></div>'):"").append($('<div class="row"></div>').append($('<div class="col-xs-2"></div>')).append($('<div class="col-xs-10 pl0"></div>').append($('<div class="stat-wraper"></div>').append($('<span class="fs16 bold lh24" id="status">').html(n.clientStatus[t.clientStatus])).append($('<span class="date pull-right" id="time">').html(t.createTime.split(" ")[0]))).append($('<div class="text-gray2 p5" id="remark">备注：</div>').append($("<span></span>").html(t.remark?t.remark:"无"))))))}),a.find(".important").click(BrokerWeb.toggleCollect),$("<section></section>").append(a).append(s)}function o(){var e=BrokerWeb;e.customer.client;$.each(e.customer.clientBuildingRelations,function(n,t){console.log(n,"i"),$("#container").append(e.setCustomerInfoItem(t))}),e.bindScroll(),e.screen.unlock()}function s(e){var n="",t=new Date(e).getTime(),a=(new Date).getTime(),o=t-a;return o>0?(o=Math.floor(o/1e3),o>31536e3&&(n+=Math.floor(o/31536e3)+"年",o%=31536e3),o>2592e3&&(n+=Math.floor(o/2592e3)+"月",o%=2592e3),o>86400&&(n+=Math.floor(o/86400)+"天",o%=86400),o>3600&&(n+=Math.floor(o/3600)+"小时",o%=3600),o>60&&(n+=Math.floor(o/60)+"分",o%=60)):n="已过期",n}function r(){var e=BrokerWeb,n=e.params.state,t=e.params.isVip,a={brokerId:e.brokerid,clientId:e.params.clientId};n&&(a.state=n),t&&(a.isVip=t),e.screen.lock(),$.ajax({url:e.apiBaseUrl+"/broker/rest/broker/getBrokerClientinfo",type:"GET",dataType:"json",data:a,success:function(n){e.screen.unlock(),n.result?(e.customer=n.objValue,e.setCustomerInfoList()):window.location.href="ShowDialog:900950.com?msg="+n.value},error:function(){e.screen.unlock()}})}function i(){var e=BrokerWeb;e.screen.lock(),$.ajax({url:e.apiBaseUrl+"/broker/rest/collect/isCollect",type:"GET",dataType:"json",data:{brokerId:e.brokerid,relationId:e.params.clientId},success:function(n){e.isCollect=n.result,e.getCustomerInfo(),e.screen.unlock()},error:function(){e.screen.unlock()}})}function l(){var e=BrokerWeb;("undefined"==typeof e.params.login||"0"==e.params.login)&&(window.location.href="ShouldLogin:900950.com"),e.clientStatus={"-10":"推荐失败","-20":"已过期","-40":"已过期","-50":"已过期","-60":"已过期",10:"推荐确认",20:"可预约",30:"已预约未验证",40:"已预约",50:"已看房",60:"看房已复核",70:"已成交",100:"成交复核"},e.getCollectionInfo()}$.extend(BrokerWeb,{getCustomerInfo:r,setCustomerInfoList:o,setCustomerInfoItem:a,bindScroll:n,getLeftTime:s,getCollectionInfo:i,toggleCollect:t,rePush:e}),BrokerWeb.init(l)});</script>