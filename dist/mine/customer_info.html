<!DOCTYPE html><html><head><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1"><meta name="keywords" content=""><meta name="description" content=" "><meta charset="utf-8"><link href="../css/bootstrap.css" rel="stylesheet"><link href="../css/onepage-scroll.css" rel="stylesheet"><link href="../css/theme.css" rel="stylesheet"></head><body><div class="container-fluid" id="container"></div></body></html><script src="../js/jquery.js"></script><script src="../js/jquery.onepage-scroll.js" =""=""></script><script src="../js/script.js"></script><script>$(document).ready(function(){function e(e){var t=BrokerWeb,a={clientName:t.customer.client.name,clientPhone:t.customer.client.phone,recommendedBuilding:e.buildingId,brokerId:e.brokerId},n="/broker/rest/broker/brokerRecommendClient";$.ajax({url:t.apiBaseUrl+n,type:"POST",data:a,dataType:"json",success:function(e){e.result?alert(e.value):alert(e.value)},error:function(){}})}function t(){$("#container").onepage_scroll({direction:"horizontal"})}function a(){var e=BrokerWeb,t={brokerId:e.brokerid,relationId:e.params.clientId};$(this).hasClass("on")?(console.log("class on"),$.ajax({url:e.apiBaseUrl+"/broker/rest/collect/delCollect",type:"POST",data:t,dataType:"json",success:function(e){e.result&&$(".important").removeClass("on"),alert(e.value)},error:function(){}})):(console.log("class no on"),$.ajax({url:e.apiBaseUrl+"/broker/rest/collect/collect/1",type:"POST",data:t,dataType:"json",success:function(e){e.result&&$(".important").addClass("on"),alert(e.value)},error:function(){}}))}function n(e){var t=BrokerWeb,a=t.customer.client,n=$('<div class="row text-center bg-user m0"></div>').append($('<div class="col-xs-8 text-left pr0"></div>').append($('<div class="pt20 pb20"></div>').append($("<div></div>").append($('<span class="text-mid text-333" id="name"></span>').html(a.name)).append($('<img src="" class="img-line-mid" id="photosrc" />').attr("src","../img/account_ico_"+("null"!=a.gender&&a.gender?"male":"female")+".png")).append($('<span class="text-green" id="phone"></span>').html(t.phoneAddSpace(a.phone)))).append($('<div class="text-666 lh-mid mt5" ></div>').append($("<div>推荐购买：</div>").append($("<span></span>").html(e.buildingName))).append($("<div>平均佣金：</div>").append($("<span></span>").html(e.buildingRatio))).append($("<div>有效期：</div>").append($("<span></span>").html(e.protectTime?t.getLeftTime(e.protectTime):"")).append(parseInt(e.clientStatus)>0?"":$('<span class="label label-green ml5 re-push">重新推荐</span>').click(function(){BrokerWeb.rePush(e)})))))).append($('<div class="col-xs-4 pr0 pt20 pb20"></div>').append(e.isSigned?$('<div class="customer-right mb10"></div>').append($('<div class="right-ok fs11"></div>').html(t.clientStatus[e.clientStatus])):"").append($('<div class="customer-right"></div>').append($('<div class="important">重要客户</div>').addClass(BrokerWeb.isCollect?"on":"")))),r=e.historys,o=$('<ul class="cust-stat list-unstyled"></ul>');return $.each(r,function(e,a){o.append($('<li class="bg-white mt15"></li>').append($('<div class="point"></div>').addClass(0==e?"active":"")).append(r.length>1?$('<div class="line"></div>'):"").append($('<div class="row"></div>').append($('<div class="col-xs-1 pr0"></div>')).append($('<div class="col-xs-11 "></div>').append($('<div class="stat-wraper"></div>').append($('<span class="text-mid" id="status">').html(t.clientStatus[a.clientStatus])).append($('<span class="date pull-right" id="time">').html(a.createTime))).append($('<div class="text-gray2 p5" id="remark">备注：</div>').append($("<span></span>").html(a.remark?a.remark:"无"))))))}),n.find(".important").click(BrokerWeb.toggleCollect),$("<section></section>").append(n).append(o)}function r(){var e=BrokerWeb;e.customer.client;$.each(e.customer.clientBuildingRelations,function(t,a){console.log(t,"i"),$("#container").append(e.setCustomerInfoItem(a))}),e.bindScroll()}function o(e){var t="",a=new Date(e).getTime(),n=(new Date).getTime(),r=a-n;return r>0?(r=Math.floor(r/1e3),r>31536e3&&(t+=Math.floor(r/31536e3)+"年",r%=31536e3),r>2592e3&&(t+=Math.floor(r/2592e3)+"月",r%=2592e3),r>86400&&(t+=Math.floor(r/86400)+"天",r%=86400),r>3600&&(t+=Math.floor(r/3600)+"小时",r%=3600),r>60&&(t+=Math.floor(r/60)+"分",r%=60)):t="已过期",t}function s(){var e=BrokerWeb;$.ajax({url:e.apiBaseUrl+"/broker/rest/broker/getBrokerClientinfo",type:"GET",dataType:"json",data:{brokerId:e.brokerid,clientId:e.params.clientId,state:e.params.state},success:function(t){console.log(t),t.result?(e.customer=t.objValue,e.setCustomerInfoList()):alert(t.value)},error:function(){}})}function i(){var e=BrokerWeb;$.ajax({url:e.apiBaseUrl+"/broker/rest/collect/isCollect",type:"GET",dataType:"json",data:{brokerId:e.brokerid,relationId:e.params.clientId},success:function(t){e.isCollect=t.result,e.getCustomerInfo()},error:function(){}})}function l(){var e=BrokerWeb;("undefined"==typeof e.params.login||"0"==e.params.login)&&(window.location.href="ShouldLogin:900950.com"),e.clientStatus={"-10":"推荐失败","-60":"已过期",10:"推荐确认",20:"可预约",30:"已预约未验证",40:"已预约",50:"已看房",60:"看房已复核",70:"已成交",100:"成交复核"},e.getCollectionInfo()}$.extend(BrokerWeb,{getCustomerInfo:s,setCustomerInfoList:r,setCustomerInfoItem:n,bindScroll:t,getLeftTime:o,getCollectionInfo:i,toggleCollect:a,rePush:e}),BrokerWeb.init(l)});</script>