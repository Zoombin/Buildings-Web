<!DOCTYPE html>
<html>
<head >
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1" />
    <meta name="keywords" content="" />
    <meta name="description" content=" "/>
    <meta charset="utf-8">
    <link href="css/bootstrap.css" rel="stylesheet">
    <link href="css/theme.css" rel="stylesheet">
</head>
<body>

<!--container -->
<div class="container-fluid" id="container">

    <!-- 头像部分// -->
    <div class="row bg-user p15"  id="top">
        <div class="col-xs-6">
            <div class="text-gray2">总积分：</div>
            <div class="text-huge text-green" id="total"></div> 
        </div>
        <div class="col-xs-6">
            <div class="text-gray2" >今日累计积分：</div>
            <div class="text-huge text-green" id="today"></div> 
        </div>
    </div>
    <!-- //头像部分 -->
    <!-- 内容部分// -->
    <div class="row earn-score score-login " id="login">
        <div class="col-xs-9 border-right">
            <div class="fs18 lh18" style="color:black">
                每日签到
            </div>
            <span id="markScore" class="themecolor"></span> <span class="text-gray">积分</span>
        </div>
        <div class="col-xs-3 score-over" id="dayMark">
            <span class="over themecolor" id="dayMarkStatus"></span>
        </div>
    </div>

    <div class="row earn-score score-qrcode ">
        <div class="col-xs-9 border-right">
            <div class="fs18 lh18 ctit">
                案场签到(扫二维码)
            </div>
            <span class=" cgreen">+500</span> <span class="text-gray">积分</span>
        </div>
        <div class="col-xs-3 score-over">
            
        </div>
    </div>

    <div class="row earn-score score-huodong ">
        <div class="col-xs-9 border-right">
            <div class="fs18 lh18 ctit">
                参加案场活动
            </div>
            <span class=" cgreen">+200-500</span> <span class="text-gray">积分</span>
        </div>
        <div class="col-xs-3 score-over">
            
        </div>
    </div>

    <div class="row earn-score score-ziyuan ">
        <div class="col-xs-9 border-right">
            <div class="fs18 lh18 ctit">
                定向资源介绍
            </div>
            <span class=" cgreen">+500-1000</span> <span class="text-gray">积分</span>
        </div>
        <div class="col-xs-3 score-over">
            
        </div>
    </div>
        <!-- //内容部分 -->

        <!-- <a href="http://www.baidu.com" class="pull-right text-green mt20 fs16 underline">积分兑换规则>></a> -->


</div>
<!-- //container -->


</body>
</html>
<script src="js/jquery.js"></script>
<script src="js/script.js"></script>
<script >
$(document).ready(function(){

function dayMark() {
    var _this = BrokerWeb;
    $.ajax({
        url: _this.apiBaseUrl + '/broker/rest/cubp/jifenJournal',
        type: 'POST',
        data: {
            token: _this.token,
            brokerId: _this.brokerid,
            type: 6,//"1": APP注册, "6": 每日签到, "9": 分享文章

        },
        success: function(data){
            _this.getBrokerScore();
            _this.checkMarked();
            window.location.href = 'ShowDialog:900950.com?msg=签到成功';
        },
        beforeSend: function(){
            _this.screen.lock();
        },
        complete: function(){
            _this.screen.unlock();
        }
    });
}

//经纪人积分信息
function getBrokerScore(){
    var _this = BrokerWeb;
    $.ajax({
        url: _this.apiBaseUrl + '/broker/rest/cubp/jifenGet?token=' + _this.token,
        type: 'GET',
        success: function(data){
            if(data.result){
                console.log('积分信息', data);
                $("#total").html(data.objValue.jifen.jifen);
                $("#today").html(data.objValue.integral);
                //data.objValue.isMark = 1;
                
            }
        },
        beforeSend: function(){
            _this.screen.lock();
        },
        complete: function(){
            _this.screen.unlock();
        }
    });
}

function getIntegralCfg(){
    var _this = BrokerWeb;
    $.ajax({
        url: _this.apiBaseUrl + '/broker/rest/cubp/getIntegralCfg/',
        type: 'GET',
        dataType: 'json',
        success: function(data){
            console.log(data);
            if(data.result){
                for(var score in data.objValue){
                    if (data.objValue[score].keys == 6) {//每日签到
                        $("#markScore").html('+' + data.objValue[score].value);
                        break;
                    }
                }
            }
        },
        beforeSend: function(){
            _this.screen.lock();
        },
        complete: function(){
            _this.screen.unlock();
        }
    });   
}

//是否签到
function checkMarked(){
    var _this = BrokerWeb;
    $.ajax({
        url: _this.apiBaseUrl + '/broker/rest/cubp/isQianDao?brokerId=' + _this.token,
        type: 'GET',
        dataType: 'json',
        success: function(data){
            console.log(data);
            if(parseInt(data.result)){
                $("#login").addClass('active');
                $("#dayMarkStatus").html('已完成');
                $("#dayMarkStatus").removeClass('themecolor');
                $("#dayMark").unbind('click');
            }else{
                $("#login").removeClass('active');
                $("#dayMarkStatus").html('签到');
            }
        },
        beforeSend: function(){
            _this.screen.lock();
        },
        complete: function(){
            _this.screen.unlock();
        }
    });   
}

//主函数入口
function main(){
    var _this = BrokerWeb;

    //判断是否登录
    if(typeof _this.params.token === 'undefined' || _this.params.token == ''){
        window.location.href = 'ShouldLogin:900950.com';
    }

    $("#dayMark").click(_this.dayMark);

    //经纪人积分信息
    _this.getBrokerScore();

    //签到加多少分是动态的
    _this.getIntegralCfg();

    //是否签到
    _this.checkMarked();
}

$.extend(BrokerWeb, {
    getBrokerScore: getBrokerScore,
    getIntegralCfg: getIntegralCfg,
    dayMark: dayMark,
    checkMarked: checkMarked
});

//主函数入口
//参数为main函数
BrokerWeb.init(main);

});
</script>
