<!doctype html>
<html>
<head>
<meta charset="UTF-8">
<title>推荐</title>
<meta content="yes" name="apple-mobile-web-app-capable">
<meta name="viewport" content="width=device-width,inital-scale=1.0,maximum-scale=1.0,user-scalable=no">
<link href="css/bootstrap.css"  rel="stylesheet" type="text/css">
<link href="css/tuijian.css"  rel="stylesheet" type="text/css">
<link href="css/theme.css"  rel="stylesheet" type="text/css">

</head>

<body style="background-color:#fff;">
<div class="container-fluid ">
    <form class="tuijian">
        <div class="input-group">
            <span class="input-group-addon text-orange"><img src="img/icon_name.png" class="img-input"/>客户姓名 |</span>
            <input type="text" class="form-control" aria-label="" placeholder="必 填 项" name="clientName" id="clientName" max-length="20">
            <span class="input-group-addon"><a href="XCFCAddress:900950.com"><img src="img/icon_book.png" class="img-input1"/></a></span>
        </div>
        <div id="clientName_error" class="text-danger text-center " style="display:none;"></div>

        <div class="input-group">
            <span class="input-group-addon text-orange"><img src="img/icon_phone.png" class="img-input"/>手机号码 |</span>
            <input type="number" class="form-control" aria-label="" placeholder="必 填 项" name="clientPhone" id="clientPhone">
            <span class="input-group-addon">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
        </div>
        <div id="clientPhone_error" class="text-danger text-center " style="display:none;"></div>

        <div class="input-group border-green">
            <span class="input-group-addon text-green"><img src="img/icon_city.png" class="img-input"/>意向城市 |</span>
            <a href="XCFCCity:900950.com" class="form-control want-city" id="recommendCity">
            必 填 项
            </a>
            <span class="input-group-addon"><img src="img/icon_arrow.png" class="img-input2"/></span>

        </div>

        <div class="input-group border-green">
            <span class="input-group-addon text-green"><img src="img/icon_building.png" class="img-input"/>意向楼盘 |</span>
            <select class="form-control wh" id="area_list">
                                                   
            </select>
            <select class="form-control wh" name="recommendedBuilding" id="recommendedBuilding" >
                
            </select>
            <span class="input-group-addon"><img src="img/icon_arrow.png" class="img-input2"/></span>
        </div>
        <div id="recommendedBuilding_error" class="text-danger text-center " style="display:none;"></div>

        <div class="input-group border-green">
            <span class="input-group-addon text-green"><img src="img/icon_date.png" class="img-input"/>看房日期 |</span>
            <input type="date" class="form-control date-input" aria-label="" name="recommendDate" id="recommendDate">
            <span class="input-group-addon"><img src="img/icon_arrow.png" class="img-input2"/></span>
        </div>

        <textarea  class="form-control mt15 border" rows="5" placeholder="备注" name="recommendMark" id="recommendMark"></textarea>

        <button class="btn btn-green w100 mt20" type="button" id="submit">立即推荐</button>

    </form>

    <div class="text-center text-gray pt20 pb20 text-nowrap">
        <div class="center-line">
            <span>友情提醒：只有通过实名认证才能提取佣金</span>
        </div>
    </div> 
</div>
</body>
</html>
<script src="js/jquery.js"></script>
<script src="js/script.js"></script>
<script >
$(document).ready(function(){

//验证姓名
function clientNameBlur(){
    var clientName = $("#clientName").val();
    if(clientName==""){
        hasError = true;
        $("#clientName_error").html('客户姓名为必填项').show();
    }else if(clientName.length<2 || clientName.length>20){
        hasError = true;
        $("#clientName_error").html('客户姓名2-20个字符').show();
    }else{
        hasError = false;
        $("#clientName_error").html('').hide();
    }
    return hasError;
}

//验证手机号码
function clientPhoneBlur(){
    var clientPhone = $("#clientPhone").val();
    if(clientPhone==''){
        hasError = true;
        $("#clientPhone_error").html('手机号码为必填项').show();
    }else if( !(/^1[3|5|6|8|9][0-9]\d{4,8}$/.test(clientPhone)) ){
        hasError = true;
        $("#clientPhone_error").html('请输入有效的手机号码').show();
    }else{
        hasError = false;
        $("#clientPhone_error").html('').hide();
    }
    return hasError;
}

//验证意向楼盘
function recommendedBuildingBlur(){
    var rb = $("#recommendedBuilding").val();
    if(rb==''){
        hasError = true;
        $("#recommendedBuilding_error").html('意向楼盘为必选项').show();
    }else{
        hasError = false;
        $("#recommendedBuilding_error").html('').hide();
    }
    return hasError;
}

//提交表单
function submitForm(){
    _this = BrokerWeb;

    if( clientNameBlur() || clientPhoneBlur() || recommendedBuildingBlur() || hasError){
        return;
    }
    var data = {
        clientName: $("#clientName").val(),
        clientPhone: $("#clientPhone").val(),
        recommendedBuilding: $("#recommendedBuilding").val(),
        brokerid: _this.brokerid,
        recommendMark: $("#recommendMark").val(),
        recommendCity: $("#recommendCity").html(),
        recommendDate: $("#recommendDate").val()
    };
    console.log('data',data);
    $.ajax({
        url: _this.apiBaseUrl + '/broker/rest/broker/brokerRecommendClient',
        type: 'POST',
        data: data,
        dataType: 'json',
        success: function(data){
            if(data.result){
                alert('提交成功');
                window.location.reload();
            }
        },
        error: function(){
            //提交出错
        }

    });
}


//设置城市名称和城市id，通过id请求楼盘信息
function setCity(cityName, cityID){
    $("#recommendCity").removeClass('color-555').addClass('color-555').html(cityName);
    $.ajax({
        url: _this.apiBaseUrl + '/broker/sys/getAreaBuildingTree/' + cityID,
        type: 'POST',
        dataType: 'json',
        success: function(data){
            console.log('成功', data);//提交成功 

            _this.areas = data.objValue;

            _this.setArea();
        },
        error: function(){
            //提交出错
        }
    });
}

function setArea(){
    var _this = BrokerWeb;
    var areas = _this.areas;

    var area_buildings = {};

    var area_str = '';

    $("#area_list").html('');
    $("#recommendedBuilding").html('');

    $.each(areas, function(i, it){
        area_buildings[it.id] = it.children;

        area_str += '<option value="'+it.id+'">'+it.text+'</option>';

    });

    $('#area_list').append(area_str).change(function(){
        var pid = $(this).val();
        $.each(area_buildings[pid], function(i, bd){
            $("#recommendedBuilding").append('<option value="'+bd.id+'">'+bd.text+'</option>');
        });
    });
}

//从通讯录设置姓名和手机
function setFromContact(name, phone){
    $("#clientName").val(name),
    $("#clientPhone").val(phone);
}

//主函数入口
function main(){
    _this = BrokerWeb;

    $("#clientName").on('input blur', _this.clientNameBlur);
    $("#clientPhone").on('input blur', _this.clientPhoneBlur);
    $("#recommendedBuilding").on('input blur', _this.recommendedBuildingBlur);

    $("#submit").click(_this.submitForm);

    //_this.setCity('sth','a38c542ddaf94a32b20160e949792b4b');

}

$.extend(BrokerWeb, {
    hasError: false,
    clientNameBlur: clientNameBlur,
    clientPhoneBlur: clientPhoneBlur,
    recommendedBuildingBlur: recommendedBuildingBlur,
    submitForm: submitForm,
    //从通讯录设置姓名和手机
    //调用方法：BrokerWeb.setFromContact(name, phone);
    setFromContact: setFromContact,
    setCity: setCity,
    setArea: setArea
});

//主函数入口
//参数为main函数
BrokerWeb.init(main);
});

</script>
